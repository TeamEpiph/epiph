<template name="editQuestionnaireQuestion">
  <div class="question {{questionCSS}} row" data-index={{index}} data-id={{_id}}>
  {{#if eq type "description"}}
    <div class="col-xs-12">
      {{#markdown}}{{label}}{{/markdown}}
    </div>
  {{else}}
    <div class="col-xs-12">
      {{#if eq type "table"}}
        {{#with question=this}}
          {{> questionTable}}
        {{/with}}
      {{else}}
        {{#if eq type "table_polar"}}
          {{#with question=this}}
            {{> questionTablePolar}}
          {{/with}}
        {{else}}
        {{#autoForm doc=null schema=schema id="questionsDummyForm" type="normal" class="questionnaireForm"}}
          {{#each afFieldNames}}
            {{> afQuickField name=this.name options=afOptionsFromSchema}}
          {{/each}}
        {{/autoForm}}
        {{/if}}
      {{/if}}
    </div>
  {{/if}}
</div>
{{#if break}}
<div class="row">
  <div class="col-xs-12">
    <div style="height: 2px; background-color: black; text-align: center; margin: 10px 0px;">
      <span style="background-color: white; position: relative; top: -0.8em; padding: 0px 5px;">
        PAGE BREAK
      </span>
    </div>
  </div>
</div>
{{/if}}
</template>

<template name="editQuestionnaire">
<div class="editQuestionnaire">
  <div class="row">
    <div class="col-xs-12">
      <h3>{{title}}
        <small>{{id}}</small>
        <button id="editQuestionnaire" class="btn btn-default btn-sm btn-hdr">
          Edit&nbsp;<i class="fa fa-lg fa-pencil"></i>
        </button>
        <button id="previewQuestionnaire" class="btn btn-default btn-sm btn-hdr">
          Preview&nbsp;<i class="fa fa-lg fa-eye"></i>
        </button>
      </h3>
    </div>
  </div>
  <div class="row">
    {{#unless isFullscreen}}
    <div class="col-xs-12 col-md-6">
      {{#unless hasQuestions}}
        This questionnaire contains no questions yet.
      {{else}}
      <div class="questionnaire">
        <div class="questions">
          {{#each questionSchemas}}
            {{> editQuestionnaireQuestion}}
          {{/each}}	
        </div>
      </div>
      {{/unless}}
      <br>
      <button id="addQuestion" class="btn btn-primary">
        Add Question <i class="fa fa-plus"></i>
      </button>
      <button id="addText" class="btn btn-primary">
        Add Text <i class="fa fa-plus"></i>
      </button>
      {{#if selectedQuestion}}
      <button id="copyQuestion" class="btn btn-primary">
        Copy selected Question <i class="fa fa-copy"></i>
      </button>
      {{/if}}
    </div>
    {{/unless}}
    <div class={{questionEditorColClass}}>
      <div id="questionEditor">
        <div class="panel panel-info">
          {{#with selectedQuestion}}
          <div class="panel-heading">
            <button class="btn btn-default btn-sm" id="toggleFullscreen">
              <i class="fa {{fullscreenToggleFAClass}}"></i>
            </button>
            Item #{{index}}
          </div>
          {{else}}
          <div class="panel-heading">Questionnaire</div>
          {{/with}}
          <div class="panel-body">
            {{#with selectedQuestion}}
            {{#autoForm doc=this schema=questionFormSchema id="questionForm" type="method-update" meteormethod="updateQuestion" class="questionForm"}}
            <div class="buttons-container">
              <div class="buttons pull-right">
                <button type="button" id="removeQuestion" class="btn btn-danger">Delete</button>
                <button type="reset" class="btn btn-warning">Reset</button>
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </div>
            {{#each afFieldNames}}
            {{> afQuickField name=this.name options=afOptionsFromSchema template="tight-horizontal" label-class="col-sm-2" input-col-class="col-sm-10"}}
            {{/each}}
            <div class="buttons pull-right">
              <button type="button" id="removeQuestion" class="btn btn-danger">Delete</button>
              <button type="reset" class="btn btn-warning">Reset</button>
              <button type="submit" class="btn btn-primary">Save</button>
            </div>
            {{/autoForm}}
            {{else}}
            {{#autoForm doc=this schema=questionnaireSchema id="questionnaireEditForm" type="method-update" meteormethod="updateQuestionnaire" class="questionEditForm" autosave=false}}
            {{#each afFieldNames}}
            {{> afQuickField name=this.name options=afOptionsFromSchema}}
            {{/each}}
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="reset" class="btn btn-warning">Reset</button>
            {{/autoForm}}
            {{/with}}
          </div>
        </div>
        <br>
        <button id="addQuestion" class="btn btn-primary">
          Add Question <i class="fa fa-plus"></i>
        </button>
        <button id="addText" class="btn btn-primary">
          Add Text <i class="fa fa-plus"></i>
        </button>
        {{#if selectedQuestion}}
        <button id="copyQuestion" class="btn btn-primary">
          Copy Question <i class="fa fa-copy"></i>
        </button>
        {{/if}}
      </div>
    </div>
  </div>
</div>
</template>
